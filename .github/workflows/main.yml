name: Build AUR Packages

on:
  push:
    branches: [ main ]
  workflow_dispatch:           # чтобы можно было запускать вручную
  schedule:
    - cron: "17 2 * * 0"        # каждый воскресенье в 2:17 UTC — оставь как есть

jobs:
  build_repository:
    runs-on: ubuntu-latest
    permissions:
      contents: write           # обязательно для релизов и gh-pages

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Build Packages
      id: build
      uses: ./
      with:
        packages: |
          fastfetch-git
          google-chrome
          spotify
          nvidia-container-toolkit-bin
          # ← сюда просто добавляй свои пакеты, каждый с новой строки

    - name: Publish to Releases
      uses: softprops/action-gh-release@v2
      with:
        tag_name: latest
        name: Latest AUR build
        prerelease: true
        files: |
          ${{ steps.build.outputs.package_dir }}/*.pkg.tar.zst
          ${{ steps.build.outputs.package_dir }}/aurci2.db*
          ${{ steps.build.outputs.package_dir }}/aurci2.files*

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v4
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ${{ steps.build.outputs.package_dir }}
        publish_branch: gh-pages
        force_orphan: true
